"h_params_f", "h_params_m",
"k_params_f", "k_params_m",
"tp_params"), DLL="ccmpp_LQuad_bothsexes")
dyn.load(dynlib("C:/Users/ktang3/Desktop/Imperial/Pop_Construct/ccmpp_LQuad_bothsexes"))
input.LQ.both <- list(data = data.bothsexes, par_init = par.bothsexes, model = "ccmpp_vr_tmb")
fit.LQ.both <- fit_tmb(input.LQ.both,inner_verbose=TRUE, random = c("log_basepop_f", "log_basepop_m",
"log_fx",
"gx_f", "gx_m",
"h_params_f", "h_params_m",
"k_params_f", "k_params_m",
"tp_params"), DLL="ccmpp_LQuad_bothsexes")
###plots####
mf5 <- projection_model_frames(bf.idx5)
#empirical sx
emp.sx.m <- emp.sx.f <- matrix(0, nrow(bf.pop.aggr.m)-1, ncol(bf.pop.aggr.m)-1)
for(j in 1:(ncol(bf.pop.aggr.m)-1)) {
for (i in 1:(nrow(bf.pop.aggr.m)-1)) {
emp.sx.m[i,j] <- as.numeric(bf.pop.aggr.m[i+1,j+1] / bf.pop.aggr.m[i,j])
emp.sx.f[i,j] <- as.numeric(bf.pop.aggr.f[i+1,j+1] / bf.pop.aggr.f[i,j])
}
}
rownames(emp.sx.m) <- rownames(emp.sx.f) <- seq(0,75,by=5)
colnames(emp.sx.m) <- colnames(emp.sx.f) <- bf.idx5$periods[-bf.idx5$n_periods]
s4515.df <- reshape2::melt(t(1-apply(emp.sx.m[4:12,],2,prod))) %>% dplyr::select(year = Var2, s4515 = value) %>% mutate(source="empirical", sex="male") %>%
bind_rows(reshape2::melt(t(1-apply(emp.sx.f[4:12,],2,prod))) %>% dplyr::select(year = Var2, s4515 = value) %>% mutate(source="empirical", sex="female")) %>%
bind_rows(
crossing(year = bf.idx5$periods, sex=c("female","male")) %>% arrange(sex,year) %>%
mutate(s4515 = c(1-apply(fit.LQ.both$mode$sx_mat_f[5:13,],2,prod),1-apply(fit.LQ.both$mode$sx_mat_m[5:13,],2,prod)), source = "LQ"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2)
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(valuse = c("red", "blue"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("dashed","solid"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("dotted","solid"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("d","a"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("dashed","solid"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("dashed","d"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("dashed","longdahs"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c("dashed","longdash"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values=1:2)
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,3))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,7))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,22))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,5))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,2))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,3))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,4))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,6))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,9))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype_manual(values = c(1,10))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical \n(deaths + migration)", "LogQuad Estimates"))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle() +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle("") +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle(bquote(1-""[45]*s[15]~"Empirical vs LQ Modelled")) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle(bquote(1-""[45]*s[15]~"Empirical vs LQ Modelled")) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15), legend.text = element_text(size=15))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle(bquote(1-""[45]*s[15]~"Empirical vs LQ Modelled")) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15), legend.text = element_text(size=10))
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle(bquote(1-""[45]*s[15]~"Empirical vs LQ Modelled")) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
gx_m
#migration
gx_m <- matrix(fit.LQ.both$mode$gx_m, bf.idx5$n_ages, bf.idx5$n_periods)
gx_f <- matrix(fit.LQ.both$mode$gx_f, bf.idx5$n_ages, bf.idx5$n_periods)
rownames(gx_m) <- rownames(gx_f) <- bf.idx5$ages
colnames(gx_m) <- colnames(gx_f) <- bf.idx5$periods
ggsave(filename="CCMPP 1-s4515.png",device="png",width=15.4686,height=8.898466667,unit="cm",scale=3.15,
plot={
ggplot(s4515.df) + geom_line(aes(x = year, y = s4515, color = sex, linetype = source), lwd = 1.2) +
scale_color_manual(values = c("red", "blue")) + scale_linetype(labels = c("Empirical (deaths + migration)", "LogQuad Estimates")) +
ylab(bquote(1 - ""[45]*s[15])) + ggtitle(bquote(1-""[45]*s[15]~"Empirical vs LQ Modelled")) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
})
getwd()
setwd("C:/Users/ktang3/Desktop/Imperial/Pop_Construct/Burkina Faso")
###plots####
mf5 <- projection_model_frames(bf.idx5)
mf5$mf_migrations
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_m,fit.LQ.both$mode$migrations_m),
source = "Fitted")
setdiff(mf5$mf_population,mf5$mf_migrations)
mf5$mf_population$period
mf5$mf_migrations %>% arrange(sex,period,age)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m))
)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m))
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m))
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m))
)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)),.name_repair="unique"
)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)) %>%
filter(period %in% mf5$mf_migrations$period)
)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m))
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m), .name_repair="universal")
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m), .name_repair="universal"))
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m), .name_repair="universal"))
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)) %>%
filter(period %in% mf5$mf_migrations$period),
.name_repair="universal")
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)) %>%
filter(period %in% mf5$mf_migrations$period),
.name_repair="unique")
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)) %>%
filter(period %in% mf5$mf_migrations$period),
.name_repair="universal")
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)) %>%
filter(period %in% mf5$mf_migrations$period),
.name_repair="ucheck_unique")
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
bind_cols(
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)) %>%
filter(period %in% mf5$mf_migrations$period),
.name_repair="check_unique")
mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)))
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)))
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age"))
(mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age"))))$period
g4515.df <- mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age"))
g4515.df$period
g4515.df <- mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age"))
g4515.df
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age")) %>%
filter(age %in% 15:55) %>% group_by(period, sex) %>%
summarise_at(vars(migration, population), sum)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age")) %>%
filter(age %in% 15:55) %>% group_by(sex,period) %>%
summarise_at(vars(migration, population), sum)
mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age")) %>%
filter(age %in% 15:55) %>% group_by(sex,period) %>%
summarise_at(vars(migration, population), sum) %>% mutate(g4515 = migration / population)
g4515.df <- mf5$mf_migrations %>% arrange(sex,period,age) %>%
mutate(migration = c(fit.LQ.both$mode$migrations_f,fit.LQ.both$mode$migrations_m)) %>%
left_join(mf5$mf_population %>% arrange(sex,period,age) %>%
mutate(population = c(fit.LQ.both$mode$population_f,fit.LQ.both$mode$population_m)), by=c("period","sex","age")) %>%
filter(age %in% 15:55) %>% group_by(sex,period) %>%
summarise_at(vars(migration, population), sum) %>% mutate(g4515 = migration / population)
ggplot(g4515.df) + geom_line(aes(x = year, y = g4515, color = sex))
ggplot(g4515.df) + geom_line(aes(x = period, y = g4515, color = sex))
gx_m
gx_f
reshape2::melt(gx_m)
reshape2::melt(gx_m) %>% mutate(sex="male")
reshape2::melt(gx_f) %>% mutate(sex="female") %>%
bind_rows(
reshape2::melt(gx_m) %>% mutate(sex="male")
)
reshape2::melt(gx_f) %>% mutate(sex="female") %>%
bind_rows(reshape2::melt(gx_m) %>% mutate(sex="male")) %>%
setNames(c("age","year","gx","sex"))
gx.df <-reshape2::melt(gx_f) %>% mutate(sex="female") %>%
bind_rows(reshape2::melt(gx_m) %>% mutate(sex="male")) %>%
setNames(c("age","year","gx","sex"))
ggplot(filter(gx.df, age %in% 15:55))
ggplot(filter(gx.df, age %in% 15:55)) + geom_line(aes(x = year, y = gx, color = sex, group = age))
ggplot(filter(gx.df, age %in% 15:55)) + geom_line(aes(x = year, y = gx, color = age, group = age))
ggplot(filter(gx.df, age %in% 15:55)) + geom_line(aes(x = year, y = gx, color = age, group = age, linetype = sex))
ggplot(filter(gx.df, age %in% 15:55)) + geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age, linetype = sex))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age, linetype = sex)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age, linetype = sex))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = as.factor(age), linetype = sex)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age, linetype = sex))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = as.factor(age), linetype = sex)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = as.factor(age), linetype = sex))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = as.factor(age), linetype = sex), lwd = 1.5) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = as.factor(age), linetype = sex), lwd = 1.2)
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age), lwd = 1.5) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = as.factor(age), linetype = sex), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
library(ggnewscale)
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age), lwd = 1.5) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = as.factor(age), linetype = sex), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age), lwd = 1.5) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, linetype = sex), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age), lwd = 1.5) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age), lwd = 1.2)
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
gx_m
gx_f
gx_m
gx_f
gx_m
ggsave(filename="gx 15 to 60.png",device="png",width=15.4686,height=8.898466667,unit="cm",scale=3.15,
plot = {
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan"))
})
gx_init
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]g[x])) + hline() +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]g[x])) + abline(h=0) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + abline(h=0) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + abline(h=0) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x]))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + abline(h=0)
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + geom_abline(h=0)
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + geom_hline(yintercept = 0) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + geom_hline(yintercept = 0, lwd=1.2) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
ggsave(filename="gx 15 to 60.png",device="png",width=15.4686,height=8.898466667,unit="cm",scale=3.15,
plot = {
ggplot(filter(gx.df, age %in% 15:55)) +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="female"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2) +
scale_color_gradientn(colors=c("gray40","red","magenta")) + new_scale_color() +
geom_line(data = filter(gx.df, age %in% 15:55, sex=="male"), aes(x = year, y = gx, color = age, group = age), lwd = 1.2, linetype = 2) +
scale_color_gradientn(colors=c("gray40","blue","cyan")) +
ggtitle(bquote("Estimated"~""[5]*g[x])) + geom_hline(yintercept = 0, lwd=1.2) +
theme(plot.title = element_text(hjust = 0.5, size = 30), title = element_text(size = 20), axis.text = element_text(size = 15))
})
gx_int
gx_init
q4515
#45q15
q4515.f<-apply(fit.LQ.both$mode$mx_mat_f[4:12,],2,function(x){1-prod((1-2.5*x)/(1+2.5*x))})
q4515.m<-apply(fit.LQ.both$mode$mx_mat_m[4:12,],2,function(x){1-prod((1-2.5*x)/(1+2.5*x))})
q4515.f
q4515.m
gx_m
fit.LQ.both$par
exp(1)/(1+exp(1))
cbind(rep(0,bf.idx5$n_periods-1), diag(bf.idx5$n_periods-1))
cbind(diag(bf.idx5$n_periods - 1), rep(0,bf.idx5$n_periods - 1))
log(0.2)
log(0.1)
compile("C:/Users/ktang3/Desktop/Imperial/Pop_Construct/ccmpp_LQuad_bothsexes_AR.cpp")
compile("C:/Users/ktang3/Desktop/Imperial/Pop_Construct/ccmpp_LQuad_bothsexes_AR.cpp")
dyn.load(dynlib("C:/Users/ktang3/Desktop/Imperial/Pop_Construct/ccmpp_LQuad_bothsexes_AR"))
data.bothsexes <- list(log_basepop_mean_f = log_basepop_mean, log_basepop_mean_m = as.vector(log(basepop_init.m)),
log_fx_mean = log_fx_mean,
gx_mean_f = gx_mean, gx_mean_m = gx_mean,
srb = rep(1.05, bf.idx5$n_periods),
interval = 5,
n_periods = bf.idx5$n_periods,
fx_idx = 4L,
n_fx = 7L,
census_log_pop_f = as.matrix(log(bf.pop.aggr.f[,-1])), census_log_pop_m = as.matrix(log(bf.pop.aggr.m[,-1])),
census_year_idx = 2:bf.idx5$n_periods,
open_idx = bf.idx5$n_ages, #open age starting at 80
LQ_baseline_mx_DX_f = LQ.baseline.DX.ax, LQ_baseline_mx_DX_m = LQ.baseline.DX.ax.m,
h_DX_f = LQ.baseline.DX.bx, h_DX_m = LQ.baseline.DX.bx.m,
h2_DX_f = LQ.baseline.DX.cx, h2_DX_m = LQ.baseline.DX.cx.m,
k_DX_f = LQ.baseline.DX.vx, k_DX_m = LQ.baseline.DX.vx.m,
tp_DX_f = tips.DX, tp_DX_m = tips.DX.m,
penal_mx = as(crossprod(diff(diag(bf.idx5$n_periods))),"sparseMatrix"),
penal_mx_0 = as(tcrossprod(c(1,rep(0,bf.idx5$n_periods-1))),"sparseMatrix"),
penal_tp = as(crossprod(diff(diag(15))),"sparseMatrix"),
null_penal_tp = as(exp(15)*tcrossprod(c(0,1,1,1,rep(0,11))),"sparseMatrix"),
penal_tp_0 = as(tcrossprod(c(1,rep(0,14))),"sparseMatrix"),
LQ_baseline_f = as.matrix(LQcoef.f[,1:4]), LQ_baseline_m = as.matrix(LQcoef.m[,1:4]),
df = bf5.f$event, dm = bf5.m$event,
Ef = bf5.f$pyears, Em = bf5.m$pyears,
rho_mat_ones = as(cbind(rep(0,bf.idx5$n_periods - 1), diag(bf.idx5$n_periods - 1)), "sparseMatrix"),
rho_mat = as(cbind(diag(bf.idx5$n_periods - 1), rep(0,bf.idx5$n_periods - 1)), "sparseMatrix")
)
par.bothsexes <- list(log_tau2_logpop_f = 0, log_tau2_logpop_m = 0,
log_tau2_fx = 0,
log_tau2_gx_f = 0, log_tau2_gx_m = 0,
log_lambda_h_f = 0, log_lambda_h_m = 0,
log_lambda_h_0_inflated_sd_f = 0, log_lambda_h_0_inflated_sd_m = 0,
log_lambda_k_f = 0, log_lambda_k_m = 0,
log_lambda_k_0_inflated_sd_f = 0, log_lambda_k_0_inflated_sd_m = 0,
log_lambda_tp = 0,
log_lambda_tp_0_inflated_sd = 0,
log_dispersion_f = 2, log_dispersion_m = 2,
log_basepop_f = log_basepop_mean, log_basepop_m = as.vector(log(basepop_init.m)),
log_fx = log_fx_mean,
gx_f = gx_mean, gx_m = gx_mean,
h_params_f = rep(log(0.2),bf.idx5$n_periods), h_params_m = rep(log(0.2),bf.idx5$n_periods),
k_params_f = rep(0,bf.idx5$n_periods), k_params_m = rep(0,bf.idx5$n_periods),
tp_params = rep(0,15),
logit_rho_h_f = 0.5, logit_rho_h_m = 0.5,
logit_rho_k_f = 0.5, logit_rho_k_m = 0.5,
h_constant_f = log(0.1), h_constant_m = log(0.1)
)
input.LQ.both.AR <- list(data = data.bothsexes, par_init = par.bothsexes, model = "ccmpp_vr_tmb")
input.LQ.both <- list(data = data.bothsexes, par_init = par.bothsexes, model = "ccmpp_vr_tmb")
fit.LQ.both.AR <- fit_tmb(input.LQ.both,inner_verbose=TRUE, random = c("log_basepop_f", "log_basepop_m",
"log_fx",
"gx_f", "gx_m",
"h_params_f", "h_params_m",
"k_params_f", "k_params_m",
"tp_params"), DLL="ccmpp_LQuad_bothsexes_AR")
fit.LQ.both.AR <- fit_tmb(input.LQ.both,inner_verbose=TRUE, random = c("log_basepop_f", "log_basepop_m",
"log_fx",
"gx_f", "gx_m",
"h_params_f", "h_params_m",
"k_params_f", "k_params_m",
"h_constant_f", "h_constant_m",
"tp_params"), DLL="ccmpp_LQuad_bothsexes_AR")
fit.LQ.both.AR$par
split(fit.LQ.both.AR$par.full,names(fit.LQ.both.AR$par.full))
split(fit.LQ.both.AR$par.full,names(fit.LQ.both.AR$par.full))$k_params
split(fit.LQ.both.AR$par.full,names(fit.LQ.both.AR$par.full))$k_params_m
split(fit.LQ.both.AR$par.full,names(fit.LQ.both.AR$par.full))$k_params_f
#45q15
q4515.f<-apply(fit.LQ.both.AR$mode$mx_mat_f[4:12,],2,function(x){1-prod((1-2.5*x)/(1+2.5*x))})
q4515.m<-apply(fit.LQ.both.AR$mode$mx_mat_m[4:12,],2,function(x){1-prod((1-2.5*x)/(1+2.5*x))})
q4515.f
q4515.m
fit.LQ.both.AR$par
split(fit.LQ.both.AR$par.full,names(fit.LQ.both.AR$par.full))$h_params_m
exp(2.1)/(1+exp(2.1))
compile("C:/Users/ktang3/Desktop/Imperial/Pop_Construct/ccmpp_LQuad_bothsexes_AR.cpp")
